# Scenario: Service not accessible from within the cluster
# Service selector does not match any pod → no Endpoints → connection fails (e.g. connection refused).
# Or wrong port in Service. This demonstrates selector mismatch.
---
apiVersion: apps/v1
kind: Deployment
metadata:
  name: app-with-wrong-labels
  labels:
    app: demo-app
    scenario: service-not-accessible
spec:
  replicas: 1
  selector:
    matchLabels:
      app: demo-app
  template:
    metadata:
      labels:
        # Pods have label "app: demo-app" but Service below selects "app: wrong-selector"
        # so the Service has no endpoints and is not accessible.
        app: demo-app
        scenario: service-not-accessible
    spec:
      containers:
        - name: app
          image: busybox:1.36
          command: ["sleep", "3600"]
          ports:
            - containerPort: 8080
          resources:
            requests:
              memory: "16Mi"
              cpu: "10m"
---
apiVersion: v1
kind: Service
metadata:
  name: demo-svc
  labels:
    scenario: service-not-accessible
spec:
  # Selector does NOT match pod labels (pods have app=demo-app, we select app=wrong-selector)
  selector:
    app: wrong-selector
  ports:
    - port: 80
      targetPort: 8080
      protocol: TCP
  type: ClusterIP
